---
import Layout from "@layouts/Layout.astro";
import Hero from "@components/Hero.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "@lib/consts";
import { getLangFromUrl } from "@i18n/utils";
import type { BlogData } from "@lib/types";
import { supabase } from "@lib/supabase";

const {
  data: { user },
} = await supabase.auth.getUser();

const lang = getLangFromUrl(Astro.url);
const isAuthorized = Boolean(user);

// Inicializar blogsData como array vazio
let blogsData: BlogData[] = [];

if (isAuthorized) {
} else {
  const cookie = Astro.cookies.get("blogiis");
  try {
    blogsData = cookie ? JSON.parse(cookie.value) : [];
  } catch (error) {
    console.error("Erro ao ler o cookie 'blogiis'", error);
  }
}
---

<Layout title={SITE_TITLE} description={SITE_DESCRIPTION} {lang}>
  <Hero {lang} {isAuthorized} {blogsData} />
</Layout>
