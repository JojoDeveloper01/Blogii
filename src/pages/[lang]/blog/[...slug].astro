---
import BlogPost from "@layouts/BlogPost.astro";
import { render } from "astro:content";
import { Editor } from "@components/Editing/Editor";

const currentPage = Astro.url.pathname.split("/").filter(Boolean).at(-1);
const id = Astro.url.searchParams.get("id");
const editing = Astro.url.searchParams.get("editing");

//console.log("Route Debug:", { currentPage, id, editing });

let blog = null;
let needsClientData = false;

if (currentPage === "temp") {
	needsClientData = true;
	blog = {
		id: id || "",
		collection: "blog" as const,
		data: {
			title: id || "",
			pubDate: new Date(),
		},
	};
}

const { Content } =
	blog && !needsClientData ? await render(blog) : { Content: null };
---

{
	needsClientData && blog ? (
		<BlogPost {...blog.data}>
			<Editor blog={blog} client:load />
		</BlogPost>
	) : blog ? (
		<BlogPost {...blog.data}>
			{editing ? (
				<Editor blog={blog} client:load />
			) : Content ? (
				<Content />
			) : null}
		</BlogPost>
	) : null
}

<style>
	/* Personalizar o bloco do editor */
	#editorjs {
		background-color: #f9fafb;
		color: #111827;
		border: 2px solid #cbd5e1;
		border-radius: 0.5rem;
	}

	/* Blocos de texto */
	.ce-paragraph {
		font-size: 1rem;
		line-height: 1.6;
		color: #1f2937;
	}

	/* Bot√µes e barra de ferramentas */
	.ce-toolbar__plus,
	.ce-toolbar__settings-btn {
		background-color: #e2e8f0;
		color: #1e293b;
	}

	.ce-toolbar__plus:hover {
		background-color: #cbd5e1;
	}
</style>
