---
import BlogPost from "@layouts/BlogPost.astro";
import { render } from "astro:content";
import { getTemp, sanitizeString } from "@lib/utils";
import { Editor } from "@components/Editing/Editor";

const currentPage = Astro.url.pathname.split("/").filter(Boolean).at(-1);

const id = Astro.url.searchParams.get("id");
const editing = Astro.url.searchParams.get("editing");

let blog = null;

if (currentPage === "temp") {
	const tempBlog = getTemp(Astro);

	//console.log("tempBlog:", JSON.stringify(tempBlog, null, 2));

	if (tempBlog) {
		tempBlog.data.pubDate = new Date(tempBlog.data.pubDate);
	}

	const sanitizedTitle = sanitizeString(String(tempBlog?.data?.title), 1);
	blog = sanitizedTitle === id ? tempBlog : null;
}

//console.log("sanitizedTitle: ", sanitizedTitle, "=", slug);

if (!blog) {
	return Astro.redirect("/404");
}

const { Content } = await render(blog);
---

<BlogPost {...blog.data}>
	{editing ? <Editor {blog} /> : <Content />}
</BlogPost>

<style>
	/* Personalizar o bloco do editor */
	#editorjs {
		background-color: #f9fafb;
		color: #111827;
		border: 2px solid #cbd5e1;
		border-radius: 0.5rem;
	}

	/* Blocos de texto */
	.ce-paragraph {
		font-size: 1rem;
		line-height: 1.6;
		color: #1f2937;
	}

	/* Bot√µes e barra de ferramentas */
	.ce-toolbar__plus,
	.ce-toolbar__settings-btn {
		background-color: #e2e8f0;
		color: #1e293b;
	}

	.ce-toolbar__plus:hover {
		background-color: #cbd5e1;
	}
</style>
