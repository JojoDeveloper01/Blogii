---
import BlogPost from "@layouts/BlogPost.astro";
import { sanitizeString } from "@lib/utils";
import { render } from "astro:content";
import { tempBlog } from "src/store";

const slug = Astro.url.searchParams.get("id");

if (tempBlog) {
    tempBlog.data.pubDate = new Date(tempBlog.data.pubDate);
}      

//console.log("tempBlog.title: ", tempBlog?.data?.title);

const sanitizedTitle = sanitizeString(String(tempBlog?.data?.title), 1);
console.log("sanitizedTitle: ", sanitizedTitle, "--", slug);

const blog = sanitizedTitle === slug ? tempBlog : null;

if (!blog) {
    return Astro.redirect("/404");
}

const { Content } = await render(blog);
---

<BlogPost {...tempBlog}>
    <Content />
</BlogPost>
