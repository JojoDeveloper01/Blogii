---
import BlogPost from "@layouts/BlogPost.astro";
import { sanitizeString } from "@lib/utils";
import { render } from "astro:content";

const slug = Astro.url.searchParams.get("id");

let data;

if (Astro.cookies.has("temp")) {
    const getCookie = Astro.cookies.get("temp");
    // Decodificar o cookie corretamente
    data = JSON.parse(decodeURIComponent(getCookie?.value || "[]")).data;
    data.pubDate = new Date(data.pubDate);
}

console.log("data.title: ", data.title);

const sanitizedTitle = sanitizeString(String(data.title), 1);
console.log("sanitizedTitle: ", sanitizedTitle, "--", slug);

const blog = sanitizedTitle === slug ? data : null;

if (!blog) {
    return Astro.redirect("/404");
}

const { Content } = await render(blog);
---

<BlogPost {...blog}>
    <Content />
</BlogPost>
