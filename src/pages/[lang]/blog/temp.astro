---
import Editing from "@components/Editing/Editing.astro";
import BlogPost from "@layouts/BlogPost.astro";
import { sanitizeString } from "@lib/utils";
import { render } from "astro:content";

const slug = Astro.url.searchParams.get("id");
const isEditing = Astro.url.searchParams.get("editing");

const data = Astro.cookies.has("temp")
    ? JSON.parse(decodeURIComponent(Astro.cookies.get("temp")?.value || "[]"))
          .data
    : null;

if (data) data.pubDate = new Date(data.pubDate);

const blog =
    sanitizeString(String(data?.title || ""), 1) === slug ? data : null;

if (!blog) {
    return Astro.redirect("/404");
}

const { Content } = await render(blog);
---

<BlogPost {...blog}>
    {isEditing ? <Editing /> : <Content />}
</BlogPost>
